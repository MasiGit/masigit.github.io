<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Dividends • Current vs Target</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <!-- Repo styles/scripts -->
    <link rel="stylesheet" href="lib/css/bootstrap4.6.1.min.css">
  <link rel="stylesheet" href="common.css">
  <style>
    .page-title{font-size:1.25rem;margin:0}
    .subtle{color:#6c757d}
    .card-lite{border:1px solid rgba(0,0,0,.08);border-radius:.5rem}
    .form-note{font-size:.875rem}
    .table thead th{position:sticky;top:0;background:#fff;z-index:2}
    .badge-note{font-size:.8rem}
    .cell-dash{color:#adb5bd}
    .mini{font-size:.85rem}
    .totals-grid{display:grid;grid-template-columns:repeat(4,minmax(140px,1fr));gap:10px}
    .totcard{border:1px solid rgba(0,0,0,.08);border-radius:.5rem;padding:10px}
    .totcard h3{font-size:.95rem;margin:0 0 6px 0}
    .fw-600{font-weight:600}
    .code{font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;}
  </style>
</head>
<body>

  <div class="container-fluid">
    <div class="row">
      <div class="col-12 col-md-3 col-lg-3">
        <div class="card mt-3">
          <div class="card-header main-header"><i class="fas fa-bars"></i> Menu</div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item"><a href="gtm.html"><i class="fas fa-coins"></i> GTM</a></li>
            <li class="list-group-item"><a href="stock-average.html"><i class="fas fa-chart-line"></i> Stock Average</a></li>
            <li class="list-group-item"><a href="stock-average2.html"><i class="fas fa-calculator"></i> Stock Average 2</a></li>
            <li class="list-group-item"><a href="trade-calculator.html"><i class="fas fa-exchange-alt"></i> Trade Calculator</a></li>
            <li class="list-group-item active"><a href="dividend.html" class="text-dark"><i class="fas fa-chart-pie"></i> Dividends</a></li>
            <li class="list-group-item"><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
          </ul>
        </div>
      </div>
      <div class="col-12 col-md-9 col-lg-9">
        <div class="section">
          <div class="card mt-3"><div class="card-header">Dividends — Current vs Target (2024)</div><div class="card-body">
        <div class="d-flex align-items-center justify-content-end mb-3">
          <span class="badge bg-warning text-dark badge-note">Currency: SAR</span>
        </div>

        <!-- Inputs -->
        <div class="card card-lite mb-3">
          <div class="card-body">
            <h2 class="h6 mb-3">Inputs</h2>
            <div class="row g-3">
              <!-- Stock 1 -->
              <div class="col-12">
                <div class="row g-2 align-items-end">
                  <div class="col-12 col-md-2">
                    <label class="form-label">Stock 1 Name</label>
                    <input id="name_stock1" type="text" placeholder="Enter stock name" value="Stock A" class="form-control">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Current Shares</label>
                    <input id="c_stock1" type="number" min="0" step="1" value="0" class="form-control">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Target Shares</label>
                    <input id="t_stock1" type="number" min="0" step="1" value="0" class="form-control">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Market Price (SAR)</label>
                    <input id="p_stock1" type="number" min="0" step="0.01" value="0" class="form-control">
                  </div>
                </div>
              </div>
              <!-- Stock 2 -->
              <div class="col-12">
                <div class="row g-2 align-items-end">
                  <div class="col-12 col-md-2">
                    <label class="form-label">Stock 2 Name</label>
                    <input id="name_stock2" type="text" placeholder="Enter stock name" value="Stock B" class="form-control">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Current Shares</label>
                    <input id="c_stock2" type="number" min="0" step="1" value="100" class="form-control">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Target Shares</label>
                    <input id="t_stock2" type="number" min="0" step="1" value="200" class="form-control">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Market Price (SAR)</label>
                    <input id="p_stock2" type="number" min="0" step="0.01" value="0" class="form-control">
                  </div>
                </div>
              </div>
              <!-- Stock 3 -->
              <div class="col-12">
                <div class="row g-2 align-items-end">
                  <div class="col-12 col-md-2">
                    <label class="form-label">Stock 3 Name</label>
                    <input id="name_stock3" type="text" placeholder="Enter stock name" value="Stock C" class="form-control">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Current Shares</label>
                    <input id="c_stock3" type="number" min="0" step="1" value="0" class="form-control">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Target Shares</label>
                    <input id="t_stock3" type="number" min="0" step="1" value="0" class="form-control">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Market Price (SAR)</label>
                    <input id="p_stock3" type="number" min="0" step="0.01" value="0" class="form-control">
                  </div>
                </div>
              </div>
              <!-- Stock 4 -->
              <div class="col-12">
                <div class="row g-2 align-items-end">
                  <div class="col-12 col-md-2">
                    <label class="form-label">Stock 4 Name</label>
                    <input id="name_stock4" type="text" placeholder="Enter stock name" value="Stock D" class="form-control">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Current Shares</label>
                    <input id="c_stock4" type="number" min="0" step="1" value="0" class="form-control">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Target Shares</label>
                    <input id="t_stock4" type="number" min="0" step="1" value="0" class="form-control">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Market Price (SAR)</label>
                    <input id="p_stock4" type="number" min="0" step="0.01" value="0" class="form-control">
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-3 d-flex flex-wrap gap-2">
              <button id="recalc" class="btn btn-success">Recalculate</button>
              <button id="downloadCsv" class="btn btn-outline-secondary">Download CSV</button>
              <span class="ms-auto subtle form-note">
                Schedule 2024 (distribution dates · DPS): Stock1 → 02-Jan(0.40), 20-May(0.40), 02-Jun(0.55), 26-Nov(0.55) ·
                Stock2 → 26-Jun(5.00) ·
                Stock3 → 16-Apr(0.19), 21-May(0.15), 20-Aug(0.16), 20-Nov(0.23) ·
                Stock4 → 04-Mar(1.60), 24-Sep(1.70)
              </span>
            </div>
          </div>
        </div>

        <!-- Investment & Dividend Summary -->
        <div class="card card-lite mb-3">
          <div class="card-body">
            <h2 class="h6 mb-3">Summary — Additional Shares & Investment (based on Market Price)</h2>
            <div class="table-responsive">
              <table class="table table-sm align-middle" id="sumTbl">
                <thead>
                  <tr>
                    <th>Ticker</th>
                    <th class="text-end">Current Shares</th>
                    <th class="text-end">Target Shares</th>
                    <th class="text-end">Δ Shares</th>
                    <th class="text-end">Market Price</th>
                    <th class="text-end">Investment Needed</th>
                    <th class="text-end">Annual Div (Current)</th>
                    <th class="text-end">Annual Div (Target)</th>
                    <th class="text-end">Δ Annual Div</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr class="fw-semibold">
                    <td>Total</td>
                    <td class="text-end" id="S_cur">0</td>
                    <td class="text-end" id="S_tar">0</td>
                    <td class="text-end" id="S_delta">0</td>
                    <td class="text-end"><span class="subtle">—</span></td>
                    <td class="text-end" id="INV_total">0.00</td>
                    <td class="text-end" id="AD_cur">0.00</td>
                    <td class="text-end" id="AD_tar">0.00</td>
                    <td class="text-end" id="AD_delta">0.00</td>
                  </tr>
                </tfoot>
              </table>
            </div>
            <div class="mini subtle">
              Annual dividend is calculated as <span class="code">sum(DPS in 2024) × shares</span>.
            </div>
          </div>
        </div>

        <!-- Monthly Table -->
        <div class="card card-lite">
          <div class="card-body">
            <h2 class="h6 mb-3">2024 Monthly Dividend — Current vs Target</h2>
            <div class="table-responsive">
              <table class="table table-sm align-middle" id="tbl">
                <thead>
                  <tr>
                    <th>Month</th>
                    <th class="text-end">Stock 1 (Cur)</th>
                    <th class="text-end">Stock 1 (Tar)</th>
                    <th class="text-end">Δ</th>
                    <th class="text-end">Stock 2 (Cur)</th>
                    <th class="text-end">Stock 2 (Tar)</th>
                    <th class="text-end">Δ</th>
                    <th class="text-end">Stock 3 (Cur)</th>
                    <th class="text-end">Stock 3 (Tar)</th>
                    <th class="text-end">Δ</th>
                    <th class="text-end">Stock 4 (Cur)</th>
                    <th class="text-end">Stock 4 (Tar)</th>
                    <th class="text-end">Δ</th>
                    <th class="text-end">Monthly Total (Cur)</th>
                    <th class="text-end">Monthly Total (Tar)</th>
                    <th class="text-end">Δ Total</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr class="fw-semibold">
                    <td>Yearly Total</td>
                    <td class="text-end" id="Y_stock1_cur">0.00</td>
                    <td class="text-end" id="Y_stock1_tar">0.00</td>
                    <td class="text-end" id="Y_stock1_delta">0.00</td>
                    <td class="text-end" id="Y_stock2_cur">0.00</td>
                    <td class="text-end" id="Y_stock2_tar">0.00</td>
                    <td class="text-end" id="Y_stock2_delta">0.00</td>
                    <td class="text-end" id="Y_stock3_cur">0.00</td>
                    <td class="text-end" id="Y_stock3_tar">0.00</td>
                    <td class="text-end" id="Y_stock3_delta">0.00</td>
                    <td class="text-end" id="Y_stock4_cur">0.00</td>
                    <td class="text-end" id="Y_stock4_tar">0.00</td>
                    <td class="text-end" id="Y_stock4_delta">0.00</td>
                    <td class="text-end" id="Y_all_cur">0.00</td>
                    <td class="text-end" id="Y_all_tar">0.00</td>
                    <td class="text-end" id="Y_all_delta">0.00</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>
        </div></div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="lib/scripts/bootstrap4.6.1.min.js"></script>
  <script src="common.js"></script>
  <script>
    // === Dividend schedule: 2024 (distribution/payment dates) ===
    // Each entry: { code, date:'YYYY-MM-DD', month:'Jan'..'Dec', dps:number }
    const dividends2024 = [
      // Stock 1 — quarterly in 2024
      {code:'stock1', date:'2024-01-02', month:'Jan', dps:0.40},
      {code:'stock1', date:'2024-05-20', month:'May', dps:0.40},
      {code:'stock1', date:'2024-06-02', month:'Jun', dps:0.55},
      {code:'stock1', date:'2024-11-26', month:'Nov', dps:0.55},

      // Stock 2 — FY2023 payout paid in 2024
      {code:'stock2', date:'2024-06-26', month:'Jun', dps:5.00},

      // Stock 3 — quarterly in 2024
      {code:'stock3', date:'2024-04-16', month:'Apr', dps:0.19},
      {code:'stock3', date:'2024-05-21', month:'May', dps:0.15},
      {code:'stock3', date:'2024-08-20', month:'Aug', dps:0.16},
      {code:'stock3', date:'2024-11-20', month:'Nov', dps:0.23},

      // Stock 4 — semi-annual in 2024
      {code:'stock4', date:'2024-03-04', month:'Mar', dps:1.60},
      {code:'stock4', date:'2024-09-24', month:'Sep', dps:1.70},
    ];

    const CODES = ['stock1','stock2','stock3','stock4'];
    const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

    // Build month->code sum of DPS
    const monthCodeDps = {};
    for (const m of MONTHS) monthCodeDps[m] = { 'stock1':0, 'stock2':0, 'stock3':0, 'stock4':0 };
    for (const p of dividends2024){ monthCodeDps[p.month][p.code] += p.dps; }

    // Annual DPS per code
    const annualDps = {'stock1':0,'stock2':0,'stock3':0,'stock4':0};
    for (const m of MONTHS){
      for (const c of CODES) annualDps[c] += monthCodeDps[m][c];
    }

    const $ = sel => document.querySelector(sel);
    const fmt = n => n.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});

    function getInputs(){
      const inNum = id => Number($(id).value||0);
      const inStr = id => $(id).value || '';
      return {
        cur: {
          'stock1': inNum('#c_stock1'), 'stock2': inNum('#c_stock2'),
          'stock3': inNum('#c_stock3'), 'stock4': inNum('#c_stock4'),
        },
        tar: {
          'stock1': inNum('#t_stock1'), 'stock2': inNum('#t_stock2'),
          'stock3': inNum('#t_stock3'), 'stock4': inNum('#t_stock4'),
        },
        price: {
          'stock1': inNum('#p_stock1'), 'stock2': inNum('#p_stock2'),
          'stock3': inNum('#p_stock3'), 'stock4': inNum('#p_stock4'),
        },
        names: {
          'stock1': inStr('#name_stock1'), 'stock2': inStr('#name_stock2'),
          'stock3': inStr('#name_stock3'), 'stock4': inStr('#name_stock4'),
        }
      };
    }

    function recalc(){
      const {cur, tar, price, names} = getInputs();
      
      // Update table headers with user-entered stock names
      const monthlyHeaders = document.querySelectorAll('#tbl thead th');
      if (monthlyHeaders.length >= 16) {
        monthlyHeaders[1].textContent = `${names['stock1'] || 'Stock 1'} (Cur)`;
        monthlyHeaders[2].textContent = `${names['stock1'] || 'Stock 1'} (Tar)`;
        monthlyHeaders[4].textContent = `${names['stock2'] || 'Stock 2'} (Cur)`;
        monthlyHeaders[5].textContent = `${names['stock2'] || 'Stock 2'} (Tar)`;
        monthlyHeaders[7].textContent = `${names['stock3'] || 'Stock 3'} (Cur)`;
        monthlyHeaders[8].textContent = `${names['stock3'] || 'Stock 3'} (Tar)`;
        monthlyHeaders[10].textContent = `${names['stock4'] || 'Stock 4'} (Cur)`;
        monthlyHeaders[11].textContent = `${names['stock4'] || 'Stock 4'} (Tar)`;
      }
      const tbody = $('#tbl tbody');
      tbody.innerHTML = '';

      // Yearly totals
      const Y = {
        cur: {'stock1':0,'stock2':0,'stock3':0,'stock4':0, all:0},
        tar: {'stock1':0,'stock2':0,'stock3':0,'stock4':0, all:0},
        dlt: {'stock1':0,'stock2':0,'stock3':0,'stock4':0, all:0},
      };

      // Monthly rows
      for (const m of MONTHS){
        const row = {cur:{}, tar:{}, dlt:{}};
        let mCur=0, mTar=0, mDlt=0;

        for (const c of CODES){
          const dps = monthCodeDps[m][c];
          const curVal = cur[c]*dps;
          const tarVal = tar[c]*dps;
          const dltVal = (tar[c]-cur[c])*dps;

          row.cur[c]=curVal; row.tar[c]=tarVal; row.dlt[c]=dltVal;
          mCur += curVal; mTar += tarVal; mDlt += dltVal;

          Y.cur[c]+=curVal; Y.tar[c]+=tarVal; Y.dlt[c]+=dltVal;
        }
        Y.cur.all += mCur; Y.tar.all += mTar; Y.dlt.all += mDlt;

        const td = (v)=> `<td class="text-end">${v ? fmt(v) : '<span class="cell-dash">-</span>'}</td>`;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${m}</td>
          ${td(row.cur['stock1'])}${td(row.tar['stock1'])}${td(row.dlt['stock1'])}
          ${td(row.cur['stock2'])}${td(row.tar['stock2'])}${td(row.dlt['stock2'])}
          ${td(row.cur['stock3'])}${td(row.tar['stock3'])}${td(row.dlt['stock3'])}
          ${td(row.cur['stock4'])}${td(row.tar['stock4'])}${td(row.dlt['stock4'])}
          ${td(mCur)}${td(mTar)}${td(mDlt)}
        `;
        tbody.appendChild(tr);
      }

      // Fill yearly totals row
      $('#Y_stock1_cur').textContent = fmt(Y.cur['stock1']);
      $('#Y_stock1_tar').textContent = fmt(Y.tar['stock1']);
      $('#Y_stock1_delta').textContent = fmt(Y.dlt['stock1']);

      $('#Y_stock2_cur').textContent = fmt(Y.cur['stock2']);
      $('#Y_stock2_tar').textContent = fmt(Y.tar['stock2']);
      $('#Y_stock2_delta').textContent = fmt(Y.dlt['stock2']);

      $('#Y_stock3_cur').textContent = fmt(Y.cur['stock3']);
      $('#Y_stock3_tar').textContent = fmt(Y.tar['stock3']);
      $('#Y_stock3_delta').textContent = fmt(Y.dlt['stock3']);

      $('#Y_stock4_cur').textContent = fmt(Y.cur['stock4']);
      $('#Y_stock4_tar').textContent = fmt(Y.tar['stock4']);
      $('#Y_stock4_delta').textContent = fmt(Y.dlt['stock4']);

      $('#Y_all_cur').textContent = fmt(Y.cur.all);
      $('#Y_all_tar').textContent = fmt(Y.tar.all);
      $('#Y_all_delta').textContent = fmt(Y.dlt.all);

      // Summary table: additional shares & investment; annual dividends
      const sumBody = $('#sumTbl tbody');
      sumBody.innerHTML = '';
      let S_cur=0, S_tar=0, S_delta=0, INV_total=0, AD_cur=0, AD_tar=0, AD_delta=0;

      function addSumRow(tickerLabel, code){
        const curS = cur[code];
        const tarS = tar[code];
        const deltaS = Math.max(0, tarS - curS);
        const px = price[code] || 0;
        const inv = deltaS * px;
        const ad_cur = curS * annualDps[code];
        const ad_tar = tarS * annualDps[code];
        const ad_delta = ad_tar - ad_cur;

        S_cur += curS; S_tar += tarS; S_delta += deltaS;
        INV_total += inv; AD_cur += ad_cur; AD_tar += ad_tar; AD_delta += ad_delta;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${tickerLabel}</td>
          <td class="text-end">${curS}</td>
          <td class="text-end">${tarS}</td>
          <td class="text-end">${deltaS}</td>
          <td class="text-end">${px ? fmt(px) : '<span class="cell-dash">-</span>'}</td>
          <td class="text-end">${inv ? fmt(inv) : '<span class="cell-dash">-</span>'}</td>
          <td class="text-end">${fmt(ad_cur)}</td>
          <td class="text-end">${fmt(ad_tar)}</td>
          <td class="text-end">${fmt(ad_delta)}</td>`;
        sumBody.appendChild(tr);
      }

      addSumRow(names['stock1'] || 'Stock 1', 'stock1');
      addSumRow(names['stock2'] || 'Stock 2', 'stock2');
      addSumRow(names['stock3'] || 'Stock 3', 'stock3');
      addSumRow(names['stock4'] || 'Stock 4', 'stock4');

      $('#S_cur').textContent = S_cur.toString();
      $('#S_tar').textContent = S_tar.toString();
      $('#S_delta').textContent = S_delta.toString();
      $('#INV_total').textContent = fmt(INV_total);
      $('#AD_cur').textContent = fmt(AD_cur);
      $('#AD_tar').textContent = fmt(AD_tar);
      $('#AD_delta').textContent = fmt(AD_delta);
    }

    function toCSV(){
      const {cur, tar, price, names} = getInputs();
      const rows = [];
      rows.push(['Section','Field',
        names['stock1'] || 'Stock 1',
        names['stock2'] || 'Stock 2',
        names['stock3'] || 'Stock 3',
        names['stock4'] || 'Stock 4',
        'Total/Notes']);

      // Annual DPS per share (info)
      rows.push(['Info','Annual DPS per share',
        annualDps['stock1'].toFixed(2),
        annualDps['stock2'].toFixed(2),
        annualDps['stock3'].toFixed(2),
        annualDps['stock4'].toFixed(2),
        '']);

      // Summary shares & prices
      rows.push(['Summary','Current Shares',cur['stock1'],cur['stock2'],cur['stock3'],cur['stock4'],'']);
      rows.push(['Summary','Target Shares',tar['stock1'],tar['stock2'],tar['stock3'],tar['stock4'],'']);
      rows.push(['Summary','Delta Shares',
        Math.max(0,tar['stock1']-cur['stock1']),
        Math.max(0,tar['stock2']-cur['stock2']),
        Math.max(0,tar['stock3']-cur['stock3']),
        Math.max(0,tar['stock4']-cur['stock4']),
        ''
      ]);
      rows.push(['Summary','Market Price',
        (price['stock1']||0).toFixed(2),
        (price['stock2']||0).toFixed(2),
        (price['stock3']||0).toFixed(2),
        (price['stock4']||0).toFixed(2),
        ''
      ]);

      // Monthly table
      rows.push([]);
      rows.push(['Month',
        'Stock1 Cur','Stock1 Tar','Stock1 Δ',
        'Stock2 Cur','Stock2 Tar','Stock2 Δ',
        'Stock3 Cur','Stock3 Tar','Stock3 Δ',
        'Stock4 Cur','Stock4 Tar','Stock4 Δ',
        'Total Cur','Total Tar','Total Δ'
      ]);

      let yCur=0, yTar=0, yDlt=0;
      for (const m of MONTHS){
        const r = {};
        for (const c of CODES){
          const dps = monthCodeDps[m][c];
          r[c+'_cur'] = cur[c]*dps;
          r[c+'_tar'] = tar[c]*dps;
          r[c+'_dlt'] = (tar[c]-cur[c])*dps;
        }
        const mCur = r['stock1_cur']+r['stock2_cur']+r['stock3_cur']+r['stock4_cur'];
        const mTar = r['stock1_tar']+r['stock2_tar']+r['stock3_tar']+r['stock4_tar'];
        const mDlt = mTar - mCur;
        yCur += mCur; yTar += mTar; yDlt += mDlt;

        rows.push([m,
          r['stock1_cur'].toFixed(2), r['stock1_tar'].toFixed(2), r['stock1_dlt'].toFixed(2),
          r['stock2_cur'].toFixed(2), r['stock2_tar'].toFixed(2), r['stock2_dlt'].toFixed(2),
          r['stock3_cur'].toFixed(2), r['stock3_tar'].toFixed(2), r['stock3_dlt'].toFixed(2),
          r['stock4_cur'].toFixed(2), r['stock4_tar'].toFixed(2), r['stock4_dlt'].toFixed(2),
          mCur.toFixed(2), mTar.toFixed(2), mDlt.toFixed(2)
        ]);
      }
      rows.push(['Yearly Total','','','',
                 '','','','','','','','','',
                 yCur.toFixed(2), yTar.toFixed(2), yDlt.toFixed(2)]);

      const csv = rows.map(r=>r.join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'dividends_2024_current_vs_target.csv';
      a.click();
      URL.revokeObjectURL(a.href);
    }

    document.getElementById('recalc').addEventListener('click', recalc);
    document.getElementById('downloadCsv').addEventListener('click', toCSV);
    recalc(); // initial render
  </script>
</body>
</html>
